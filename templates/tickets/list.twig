{% extends "layout.twig" %}

{% block content %}
<div class="ticket-management-container">
  <header class="ticket-management-header">
    <button class="btn btn-secondary" onclick="window.location.href='/dashboard'">
      ‚Üê Back to Dashboard
    </button>
    <h1>Ticket Management</h1>
  </header>

  <div class="ticket-stats">
    <div class="stat-card">
      <h3>{{ stats.total }}</h3>
      <p>Total Tickets</p>
    </div>
    <div class="stat-card">
      <h3>{{ stats.open }}</h3>
      <p>Open Tickets</p>
    </div>
    <div class="stat-card">
      <h3>{{ stats.closed }}</h3>
      <p>Resolved Tickets</p>
    </div>
  </div>

  <div class="ticket-form-container">
    <form method="POST" action="/tickets/create" class="ticket-form">
      <h2>Create New Ticket</h2>
      
      {% if error %}
        <div class="error-message">{{ error }}</div>
      {% endif %}
      
      <input type="hidden" id="ticketId" name="ticketId" value="" />
      
      <div class="form-group">
        <label for="title">Title *</label>
        <input
          type="text"
          id="title"
          name="title"
          class="form-control"
          placeholder="Enter ticket title"
          required
        />
      </div>
      
      <div class="form-group">
        <label for="status">Status *</label>
        <select
          id="status"
          name="status"
          class="form-control"
          required
        >
          <option value="open">Open</option>
          <option value="in_progress">In Progress</option>
          <option value="closed">Closed</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="description">Description</label>
        <textarea
          id="description"
          name="description"
          class="form-control"
          placeholder="Enter ticket description"
          rows="3"
        ></textarea>
      </div>
      
      <div class="form-group">
        <label for="priority">Priority</label>
        <select
          id="priority"
          name="priority"
          class="form-control"
        >
          <option value="low">Low</option>
          <option value="medium" selected>Medium</option>
          <option value="high">High</option>
        </select>
      </div>
      
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Create Ticket</button>
      </div>
    </form>
  </div>

  <div class="tickets-container">
    <h2>Your Tickets</h2>
    
    {% if tickets|length == 0 %}
      <div class="empty-state">
        <p>No tickets found. Create your first ticket above!</p>
      </div>
    {% else %}
      <div class="tickets-grid">
        {% for ticket in tickets %}
        <div class="ticket-card">
          <div class="ticket-header">
            <h3>{{ ticket.title }}</h3>
            <span class="status-badge status-{{ ticket.status }}">
              {{ ticket.status|replace({'_': ' '})|title }}
            </span>
          </div>
          
          <p class="ticket-description">
            {{ ticket.description or 'No description provided' }}
          </p>
          
          {% if ticket.priority %}
            <div class="ticket-meta">
              <span class="priority-badge priority-{{ ticket.priority }}">
                {{ ticket.priority|title }}
              </span>
            </div>
          {% endif %}
          
          <div class="ticket-actions">
            <button 
              class="btn btn-secondary btn-small edit-ticket-btn"
              data-ticket-id="{{ ticket.id }}"
              data-ticket-title="{{ ticket.title }}"
              data-ticket-description="{{ ticket.description|default('') }}"
              data-ticket-status="{{ ticket.status }}"
              data-ticket-priority="{{ ticket.priority|default('medium') }}"
            >
              Edit
            </button>
            <button 
              class="btn btn-danger btn-small delete-ticket-btn" 
              data-ticket-id="{{ ticket.id }}"
              data-ticket-title="{{ ticket.title }}"
            >
              Delete
            </button>
          </div>
        </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>Confirm Deletion</h3>
      <p>Are you sure you want to delete the ticket: <span id="ticketTitle"></span>?</p>
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="cancelDelete()">Cancel</button>
        <button class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
      </div>
    </div>
  </div>

  <footer class="ticket-management-footer">
    <div class="footer-content">
      <p>&copy; {{ "now"|date("Y") }} Dennis Ticket Management App. All rights reserved.</p>
      <p>
        <a href="/privacy">Privacy Policy</a> | 
        <a href="/terms">Terms of Service</a> | 
        <a href="/contact">Contact Us</a>
      </p>
    </div>
  </footer>
</div>
{% endblock %}